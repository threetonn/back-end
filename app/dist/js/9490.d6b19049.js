"use strict";(self["webpackChunktriton"]=self["webpackChunktriton"]||[]).push([[9490,9648,7181],{7181:function(e,t,a){a.r(t),a.d(t,{default:function(){return Z}});var n=a(3396),r=a(7139),s=a(9242);const l={class:"profile-page__add-train-form"},i={class:"error-msg"},o=(0,n._)("label",{class:"shedule-label",for:"trainStart"},"Начало тренировки: ",-1),u={class:"error-msg"},c=(0,n._)("label",{class:"shedule-label",for:"trainDuration"},"Длительность тренировки (мин.): ",-1),d={class:"error-msg"},v={class:"lf-inputs__wrapper"},p=(0,n._)("label",{class:"shedule-label",for:"trainEnd"},"Конец тренировки",-1),g={class:"shedule-p"},m={key:0,class:"lf-inputs__wrapper"},_={class:"shedule-select"},w=(0,n._)("label",{for:"user-select"},"Клиенты",-1),h={class:"custom-select"},D=(0,n._)("option",{disabled:"",value:""},"Выберите один из вариантов",-1),k=["selected","value"],S={key:1,class:"lf-inputs__wrapper"},T={class:"shedule-select"},f=(0,n._)("label",{for:"trainer-select"},"Тренер",-1),y={class:"custom-select"},b=(0,n._)("option",{disabled:"",value:""},"Выберите один из вариантов",-1),U=["selected","value"],N={class:"shedule-select"},F=(0,n._)("label",{for:"location-select"},"Местоположение",-1),I={class:"custom-select"},E=(0,n._)("option",{disabled:"",value:""},"Выберите один из вариантов",-1),C=["selected","value"],$={class:"error-msg"},q={key:2,class:"lf-inputs__wrapper"},V={class:"shedule-select"},L=(0,n._)("label",{for:"type-select"},"Тип тренировки",-1),z={class:"custom-select"},H=(0,n._)("option",{disabled:"",value:""},"Выберите один из вариантов",-1),M=["selected","value"],P=["disabled"];function x(e,t,a,x,A,Y){return(0,n.wg)(),(0,n.iD)("div",l,[(0,n._)("div",{class:(0,r.C_)(["lf-inputs__wrapper",{error:x.v$.trainName.$errors.length}])},[(0,n.wy)((0,n._)("input",{class:"lf-inputs__input",type:"text",name:"trainName",id:"trainName",placeholder:"Название тренировки","onUpdate:modelValue":t[0]||(t[0]=e=>x.state.trainName=e)},null,512),[[s.nr,x.state.trainName]]),((0,n.wg)(!0),(0,n.iD)(n.HY,null,(0,n.Ko)(x.v$.trainName.$errors,(e=>((0,n.wg)(),(0,n.iD)("div",{class:"input-errors",key:e.$uid},[(0,n._)("div",i,(0,r.zw)(e.$message),1)])))),128))],2),(0,n._)("div",{class:(0,r.C_)(["lf-inputs__wrapper",{error:x.v$.trainStart.$errors.length}])},[o,(0,n.wy)((0,n._)("input",{class:"lf-inputs__input date-input",type:"datetime-local",name:"trainStart",id:"trainStart",placeholder:"Начало тренировки","onUpdate:modelValue":t[1]||(t[1]=e=>x.state.trainStart=e)},null,512),[[s.nr,x.state.trainStart]]),((0,n.wg)(!0),(0,n.iD)(n.HY,null,(0,n.Ko)(x.v$.trainStart.$errors,(e=>((0,n.wg)(),(0,n.iD)("div",{class:"input-errors",key:e.$uid},[(0,n._)("div",u,(0,r.zw)(e.$message),1)])))),128))],2),(0,n._)("div",{class:(0,r.C_)(["lf-inputs__wrapper",{error:x.v$.trainDuration.$errors.length}])},[c,(0,n.wy)((0,n._)("input",{class:"lf-inputs__input",type:"number",name:"trainDuration",id:"trainDuration",placeholder:"Длительность тренировки","onUpdate:modelValue":t[2]||(t[2]=e=>x.state.trainDuration=e)},null,512),[[s.nr,x.state.trainDuration]]),((0,n.wg)(!0),(0,n.iD)(n.HY,null,(0,n.Ko)(x.v$.trainDuration.$errors,(e=>((0,n.wg)(),(0,n.iD)("div",{class:"input-errors",key:e.$uid},[(0,n._)("div",d,(0,r.zw)(e.$message),1)])))),128))],2),(0,n._)("div",v,[p,(0,n._)("p",g,(0,r.zw)(""!==x.endDate?x.endDate.toLocaleString():"-"),1)]),"trainer"===x.user.role?((0,n.wg)(),(0,n.iD)("div",m,[(0,n._)("div",_,[w,(0,n._)("div",h,[(0,n.wy)((0,n._)("select",{"onUpdate:modelValue":t[3]||(t[3]=e=>x.state.selectUser=e),id:"user-select"},[D,((0,n.wg)(!0),(0,n.iD)(n.HY,null,(0,n.Ko)(x.clients,(e=>((0,n.wg)(),(0,n.iD)("option",{selected:e.id===x.state.selectUser,key:e.id,value:e.id},(0,r.zw)(e.name),9,k)))),128))],512),[[s.bM,x.state.selectUser]])])])])):(0,n.kq)("",!0),"manager"===x.user.role?((0,n.wg)(),(0,n.iD)("div",S,[(0,n._)("div",T,[f,(0,n._)("div",y,[(0,n.wy)((0,n._)("select",{"onUpdate:modelValue":t[4]||(t[4]=e=>x.state.trainer=e),id:"trainer-select"},[b,((0,n.wg)(!0),(0,n.iD)(n.HY,null,(0,n.Ko)(x.trainersList,(e=>((0,n.wg)(),(0,n.iD)("option",{selected:e.email===x.state.trainer,key:e.email,value:e.email},(0,r.zw)(e.name),9,U)))),128))],512),[[s.bM,x.state.trainer]])])])])):(0,n.kq)("",!0),(0,n._)("div",{class:(0,r.C_)(["lf-inputs__wrapper",{error:x.v$.trainLocation.$errors.length}])},[(0,n._)("div",N,[F,(0,n._)("div",I,[(0,n.wy)((0,n._)("select",{"onUpdate:modelValue":t[5]||(t[5]=e=>x.state.trainLocation=e),id:"location-select"},[E,((0,n.wg)(!0),(0,n.iD)(n.HY,null,(0,n.Ko)(x.workoutLocations,(e=>((0,n.wg)(),(0,n.iD)("option",{selected:e.name===x.state.trainLocation,key:e.name,value:e.name},(0,r.zw)(e.address),9,C)))),128))],512),[[s.bM,x.state.trainLocation]])])]),((0,n.wg)(!0),(0,n.iD)(n.HY,null,(0,n.Ko)(x.v$.trainLocation.$errors,(e=>((0,n.wg)(),(0,n.iD)("div",{class:"input-errors",key:e.$uid},[(0,n._)("div",$,(0,r.zw)(e.$message),1)])))),128))],2),"manager"===x.user.role?((0,n.wg)(),(0,n.iD)("div",q,[(0,n._)("div",V,[L,(0,n._)("div",z,[(0,n.wy)((0,n._)("select",{"onUpdate:modelValue":t[6]||(t[6]=e=>x.state.trainType=e),id:"type-select"},[H,((0,n.wg)(!0),(0,n.iD)(n.HY,null,(0,n.Ko)(x.workoutTypes,(e=>((0,n.wg)(),(0,n.iD)("option",{selected:e.name===x.state.trainType,key:e.name,value:e.name},(0,r.zw)(e.description),9,M)))),128))],512),[[s.bM,x.state.trainType]])])])])):(0,n.kq)("",!0),(0,n._)("button",{onClick:t[7]||(t[7]=(...e)=>x.onClickScheduleButton&&x.onClickScheduleButton(...e)),class:(0,r.C_)(["button shedule-button",["shedule-button--"+x.buttonStyle.class,x.formIsValid&&"disabled"]]),disabled:x.formIsValid},(0,r.zw)(x.buttonStyle?x.buttonStyle.name:"Отправить"),11,P)])}var A=a(4870),Y=a(65),K=a(3053),O=a(9117),B=a(4030),W={props:{eventID:Number,eventName:String,eventType:String},setup(e){const t=(0,Y.oR)(),a=(0,n.Fl)((()=>t.getters.getScheduleEvents)),r=(0,n.Fl)((()=>t.getters.getPersonalEvents)),s=(0,n.Fl)((()=>t.getters.getWorkoutTypes)),l=(0,n.Fl)((()=>t.getters.getWorkoutLocations)),i=(0,n.Fl)((()=>t.getters.getTrainers)),o=(0,n.Fl)((()=>t.getters.getTokens)),u=(0,n.Fl)((()=>t.getters.getUser)),c=(0,n.Fl)((()=>t.getters.getClients)),d=(0,A.iH)(!1),v=(0,A.iH)(!1),p=(0,n.Fl)((()=>e.eventID&&"group"===e.eventType?a.value.find((t=>t.id===e.eventID)):r.value.find((t=>t.id===e.eventID)))),g=(e,t)=>(new Date(t).getTime()-new Date(e).getTime())/6e4,m=(0,n.Fl)((()=>g(p.value.start,p.value.end))),_=(0,n.Fl)((()=>"create"===e.eventName?{name:"Создать тренировку",class:"add"}:"update"===e.eventName?{name:"Изменить тренировку",class:"edit"}:"delete"===e.eventName?{name:"Удалить тренировку",class:"delete"}:{name:"Отправить",class:""})),w=(0,A.qj)({trainName:e.eventID&&p.value.title&&"update"===e.eventName?p.value.title:"",trainStart:e.eventID&&"update"===e.eventName?p.value.start:"",trainEnd:e.eventID&&"update"===e.eventName?p.value.end:"",trainLocation:e.eventID&&"update"===e.eventName?p.value.location.name:"",trainType:e.eventID&&"update"===e.eventName?p.value.type:"",trainer:e.eventID&&"update"===e.eventName?p.value.trainer.email:"",trainDuration:e.eventID&&"update"===e.eventName?m.value:0,selectUser:e.eventID&&p.value.clients&&"update"===e.eventName?p.value.clients[0]:""}),h=(0,n.Fl)((()=>w.trainStart?new Date(new Date(w.trainStart).setMinutes(new Date(w.trainStart).getMinutes()+w.trainDuration)):"")),D=e=>new Date((new Date).setDate((new Date).getDate()+7))>=new Date(e)&&new Date(e)>=new Date,k=(0,n.Fl)((()=>({trainName:{required:O.helpers.withMessage("Поле обязательно для заполнения",O.required)},trainDuration:{required:O.helpers.withMessage("Поле обязательно для заполнения",O.required),minValue:O.helpers.withMessage("Тренировка должна быть не менее 30 минут",(0,O.minValue)(30)),maxValue:O.helpers.withMessage("Тренировка должна быть не более 240 минут",(0,O.maxValue)(240))},trainStart:{required:O.helpers.withMessage("Необходимо выбрать дату!",O.required),maxDateValidator:O.helpers.withMessage("Максимально отложить дату можно на 7 дней!",D)},trainEnd:{required:O.helpers.withMessage("Необходимо выбрать дату!",O.required),maxDateValidator:O.helpers.withMessage("Максимально отложить дату можно на 7 дней!",D)},trainLocation:{required:O.helpers.withMessage("Поле обязательно для заполнения",O.required)}}))),S=(0,K.Xw)(k,w),T=()=>(S.value.$touch(),!S.value.$errors.length),f=()=>{w.trainName="",w.trainStart="",w.trainEnd="",w.trainLocation="",w.trainType="",w.trainer="",w.selectUser="",w.trainDuration=0};(0,n.wF)((()=>{"create"===e.eventName&&f()}));const y=()=>"create"===e.eventName?b():"update"===e.eventName?U():(0,B.errorNotify)("Невозможно выполнить действие"),b=()=>{if(w.trainEnd=new Date(new Date(h.value).getTime()-6e4*new Date(h.value).getTimezoneOffset()).toISOString(),w.trainStart=new Date(new Date(w.trainStart).getTime()-6e4*new Date(w.trainStart).getTimezoneOffset()).toISOString(),T()){const e={name:w.trainName,start_date:w.trainStart,end_date:w.trainEnd,gym:w.trainLocation,trainer:w.trainer,client_id:w.selectUser};return"manager"===u.value.role&&(e.workout_type=w.trainType),t.dispatch("addTrainInSchedule",{access_token:o.value.access_token,train:e,role:u.value.role}),d.value=!1,(0,B.successNotify)("Тренировка добавлена!"),f(),t.dispatch("hideScheduleEventsForm")}return(0,B.errorNotify)("Не удалось добавить тренировку")},U=()=>{if(w.trainEnd=new Date(new Date(h.value).getTime()-6e4*new Date(h.value).getTimezoneOffset()).toISOString(),w.trainStart=new Date(new Date(w.trainStart).getTime()-6e4*new Date(w.trainStart).getTimezoneOffset()).toISOString(),T()){const a={name:w.trainName,start_date:w.trainStart,end_date:w.trainEnd,workout_type:w.trainType,gym:w.trainLocation,trainer:w.trainer,selectUser:w.selectUser};return t.dispatch("editTrainInSchedule",{id:e.eventID,access_token:o.value.access_token,train:a,role:u.value.role}),d.value=!1,(0,B.successNotify)("Тренировка обновлена!"),f(),t.dispatch("hideScheduleEventsForm")}return(0,B.errorNotify)("Не удалось обновить тренировку")};return{v$:S,state:w,onClickScheduleButton:y,workoutLocations:l,workoutTypes:s,trainersList:i,endDate:h,buttonStyle:_,formIsValid:v,user:u,clients:c}}},R=a(89);const j=(0,R.Z)(W,[["render",x]]);var Z=j},8567:function(e,t,a){a.r(t),a.d(t,{default:function(){return F}});var n=a(3396),r=a(7139);const s={class:"profile-page"},l=(0,n._)("h1",{class:"profile-page__title"},"Расписание",-1),i={class:"profile-page__toggle-shedule--buttons"},o={class:"profile-page__toggle-shedule"},u={key:2,class:"card-popup"},c={class:"card"},d=(0,n._)("line",{x1:"1",y1:"16",x2:"16",y2:"1",stroke:"white","stroke-width":"2"},null,-1),v=(0,n._)("line",{x1:"1",y1:"1",x2:"16",y2:"16",stroke:"white","stroke-width":"2"},null,-1),p=[d,v],g=(0,n._)("div",{class:"card__title"},[(0,n._)("span",null,"Записать клиентов")],-1),m={class:"card__content"},_={class:"card__detail"};function w(e,t,a,d,v,w){const h=(0,n.up)("TTFormWorkout"),D=(0,n.up)("TTBlockSchedule"),k=(0,n.up)("TTElementInputSelect");return(0,n.wg)(),(0,n.iD)("div",s,[l,(0,n._)("div",i,[(0,n._)("div",o,[(0,n._)("button",{onClick:t[0]||(t[0]=e=>d.selectedPersonalEvents=!1),class:(0,r.C_)([{"toggle-btn--active":!d.selectedPersonalEvents},"toggle-btn"])}," Общее расписание ",2),"manager"!==d.user.role?((0,n.wg)(),(0,n.iD)("button",{key:0,onClick:t[1]||(t[1]=e=>d.selectedPersonalEvents=!0),class:(0,r.C_)([{"toggle-btn--active":d.selectedPersonalEvents},"toggle-btn"])}," Личное расписание ",2)):(0,n.kq)("",!0)]),"manager"===d.user.role||"trainer"===d.user.role?((0,n.wg)(),(0,n.iD)("button",{key:0,class:(0,r.C_)(["button",d.isTrainFormActive&&"button--active"]),onClick:t[2]||(t[2]=(...e)=>d.addTrain&&d.addTrain(...e))},(0,r.zw)(d.isTrainFormActive?"Переключить обратно":"Добавить тренировку"),3)):(0,n.kq)("",!0)]),d.isTrainFormActive?((0,n.wg)(),(0,n.j4)(h,{key:0,eventID:d.scheduleSelectedEventID,eventName:d.scheduleSelectedEventName,eventType:d.selectedPersonalEvents?"personal":"group"},null,8,["eventID","eventName","eventType"])):((0,n.wg)(),(0,n.j4)(D,{key:1,events:d.selectedPersonalEvents?d.personalEvents:d.scheduleEvents,signUpTrainCallback:d.signUpTrain,unSignUpTrainCallback:d.unSignUpTrain,signUpUsersForTrainCallback:d.signUpUsersForTrain,editTrainCallback:d.editTrain,deleteTrainCallback:d.deleteTrain,userRole:d.user.role,userID:d.user.id},null,8,["events","signUpTrainCallback","unSignUpTrainCallback","signUpUsersForTrainCallback","editTrainCallback","deleteTrainCallback","userRole","userID"])),d.showUsersSignUpDialog?((0,n.wg)(),(0,n.iD)("div",u,[(0,n._)("div",c,[((0,n.wg)(),(0,n.iD)("svg",{onClick:t[3]||(t[3]=(...e)=>d.handleCloseUsersSignUpDialog&&d.handleCloseUsersSignUpDialog(...e)),viewPort:"0 0 16 16",version:"1.1",xmlns:"http://www.w3.org/2000/svg"},p)),g,(0,n._)("div",m,[(0,n._)("div",_,[(0,n.Wm)(k,{fieldName:"clients",type:"text",label:"email",formType:"workoutUsersSignUp",placeholder:"Клиенты",callback:e=>d.sendSignUpUsersForTrain(e),rules:[],options:d.clients,specialButton:""},null,8,["callback","options"])])])])])):(0,n.kq)("",!0)])}var h=a(3964),D=a(7181),k=a(6989),S=a(4870),T=a(65),f=a(4030),y=a(9372),b={components:{TTBlockSchedule:h["default"],TTFormWorkout:D["default"],TTElementInputSelect:k["default"]},setup(){const e=(0,T.oR)(),t=(0,n.Fl)((()=>e.getters.getScheduleEvents)),a=(0,n.Fl)((()=>e.getters.getPersonalEvents)),r=(0,n.Fl)((()=>e.getters.getTokens)),s=(0,n.Fl)((()=>e.getters.getUser)),l=(0,n.Fl)((()=>e.getters.getClients)),i=(0,n.Fl)((()=>e.getters.getScheduleSelectedEventID)),o=(0,n.Fl)((()=>e.getters.getScheduleEventsFormActive)),u=(0,S.iH)(!1),c=(0,S.iH)(!1),d=(0,S.iH)("create"),v=(0,S.iH)(!1),p=(0,S.iH)(null),g=()=>{v.value=!1},m=()=>{const t={access_token:r.value.access_token,role:s.value.role};e.dispatch("getSchedulePesonalEvents",t)};(0,n.YP)((()=>u.value),(()=>{m()}));const _=e=>{const t=e.clients.map((e=>e.id)),a={id:p.value,access_token:r.value.access_token,clients:t};(0,y.signUpUsersForTrainAPI)(a).then((()=>g()))},w=()=>{o.value?e.dispatch("hideScheduleEventsForm"):e.dispatch("showScheduleEventsForm")},h=e=>"client"===s.value.role?(0,y.signUpClientInTrainAPI)({id:e,access_token:r.value.access_token}).then((()=>{m(),(0,f.successNotify)("Успешная регистрация!")})):(0,f.errorNotify)("Данное действие доступно только для клиентов!"),D=e=>"client"===s.value.role?(0,y.unSignUpClientInTrainAPI)({id:e,access_token:r.value.access_token}).then((()=>{m(),(0,f.successNotify)("Успешная отписка!")})):(0,f.errorNotify)("Данное действие доступно только для клиентов!"),k=e=>"manager"===s.value.role?(v.value=!0,p.value=e,console.log(e)):(0,f.errorNotify)("Данное действие доступно только для менеджеров!"),b=()=>{d.value="create",w()},U=t=>"trainer"===s.value.role||"manager"===s.value.role?(d.value="update",w(),e.dispatch("setScheduleSelectEventId",t)):(0,f.errorNotify)("Данное действие доступно только для тренеров и менеджеров!"),N=n=>{const l=[...t.value,...a.value],i=l.find((e=>e.id===n));if("trainer"===s.value.role){if(i.trainer.email!==s.value.email||"personal"!==i.type)return(0,f.errorNotify)("Удалить можно только персональные тренировки!");{let t=confirm("Удалить данную тренировку?");t&&e.dispatch("deleteTrainInSchedule",{id:n,role:s.value.role,access_token:r.value.access_token})}}if("manager"===s.value.role){if("group"!==i.type)return(0,f.errorNotify)("Удалить можно только групповые тренировки!");{let t=confirm("Удалить данную тренировку?");t&&e.dispatch("deleteTrainInSchedule",{id:n,role:s.value.role,access_token:r.value.access_token})}}};return{scheduleEvents:t,selectedPersonalEvents:u,personalEvents:a,isTrainFormActive:o,signUpTrain:h,unSignUpTrain:D,signUpUsersForTrain:k,addTrain:b,editTrain:U,deleteTrain:N,formIsValid:c,toggleActiveEventsForm:w,scheduleSelectedEventID:i,scheduleSelectedEventName:d,user:s,sendSignUpUsersForTrain:_,clients:l,showUsersSignUpDialog:v,handleCloseUsersSignUpDialog:g}}},U=a(89);const N=(0,U.Z)(b,[["render",w]]);var F=N}}]);
//# sourceMappingURL=9490.d6b19049.js.map